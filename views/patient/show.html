{% extends 'layout/application.html' %}
{% block body %}
    <script type="text/javascript">
        navButtons = [["Finish", "window.location='/'", "Green", "Right"]]
        {% if session.get('user').get('role') != 'Nurse'  %}
            navButtons.push(["New Test", "showOrderDialog()", "Defaults", "Right"])
        {% endif %}

        {% if not collect_sample  %}
            navButtons.push(["Draw Samples", "showDrawDialog()", "Defaults", "Right"])
        {% endif %}
     </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/keyboard.css') }}">
    <div class="header">
        <table style="width:100%;">
            <tr>
                <td rowspan="2">
                    {% if (pt_details.get('gender').lower() == 'm' or pt_details.get('gender').lower() == 'male') %}
                        <img src="/assets/images/male.png" >
                    {% else %}
                        <img src="/assets/images/female.png" >
                    {% endif %}
                </td>
                <td><b>Patient Name</b></td>
                <td>:</td>
                <td><i>{{pt_details.get('name')}}</i></td>
                <td><b>Age</b></td>
                <td>:</td>
                <td><i>&nbsp;</i></td>
            </tr>
            <tr>
                <td><b>Patient ID</b></td>
                <td>:</td>
                <td><i>{{ pt_details.get('id') }}</i></td>
                <td><b>DOB</b></td>
                <td>:</td>
                <td><i>{{ pt_details.get('dob') }}</i></td>
            </tr>
        </table>
    </div>
    <h2>Recent Lab Tests</h2>
    <div style="border: 1px solid silver; padding: 10px;" class="header">
        <div style="border:2px solid #0094ff;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border-top-left-radius:6px;border-top-right-radius:6px;width: 100%;margin-left: auto;margin-right:auto;font-size:12pt;">
        <h2 style="color:#fff;margin:0;background-color:#0094ff;font-size:14pt; padding: 15px;font-weight: bold;">
            Renal Function Test (20 December 2019)
        </h2>
        <div style="padding: 10px">
            <table style="width: 100%;margin-left: auto; margin-right: auto;border-collapse: collapse; line-height: 5vh;" >
                <tr>
                    <th style="height: 50px;border: 1px solid black;">Measure</th>
                    <th style="height: 50px;border: 1px solid black;">Value</th>
                    <th style="height: 50px;border: 1px solid black;">Range</th>
                </tr>
                <tr>
                    <td style="  border: 1px solid black;font-weight: bold;padding-left: 10px;">Creatinine </td>
                    <td style="  border: 1px solid black;text-align: center;">0.95</td>
                    <td style="  border: 1px solid black;text-align: center;">0.70 - 1.30</td>
                </tr>
                <tr>
                    <td style="  border: 1px solid black;font-weight: bold;padding-left: 10px;">Urea </td>
                    <td style="color: red;border: 1px solid black;text-align: center;">63.1 <span style='color: red; font-size: 2em;font-weight: bold;'>&#8593;</span></td>
                    <td style="border: 1px solid black;text-align: center;">18.00 - 55.00</td>
                </tr>
            </table>
        </div>
      </div>
    </div>

    <div id="sampleDrawContent" hidden>
        <div class="Table">
            <div class="Title">
                Sample Collection
                <div style="float: right;" onmousedown=hideDialog('{{request.url}}')>
                    <img style="vertical-align: middle;" src="/assets/images/cancel.png">
                </div>
            </div>
            <div class="Heading">
                <div class="TitleCell">
                    <p>Specimen Type</p>
                </div>
                <div class="TitleCell">
                    <p>Test</p>
                </div>
                <div class="TitleCell">
                    <p>Min Vol.</p>
                </div>
                <div class="TitleCell">
                    <p>Container</p>
                </div>
                <div class="TitleCell">
                    <p>Action</p>
                </div>
            </div>
            <div class="Row">
                <div class="Cell">
                    <p>Pericardial Fluid</p>
                </div>
                <div class="Cell">
                    <p>Sterile Fluid Analysis <br>Culture and Sensitivity</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>6 ml</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>Row 1 Column 2</p>
                </div>
                <div class="Cell">
                    <button onmousedown="window.location='/test/1/collect_specimen'">
                        <img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/draw_sample.png">
                    </button>
                    <button><img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/delete.png"></button>
                </div>
            </div>
            <div class="Row">
                <div class="Cell">
                    <p>Peritoneal Fluid</p>
                </div>
                <div class="Cell">
                    <p>Sterile Fluid Analysis</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>3 ml</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>Row 1 Column 2</p>
                </div>
                <div class="Cell">
                    <button onmousedown="window.location='/test/1/collect_specimen'">
                        <img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/draw_sample.png">
                    </button>
                    <button><img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/delete.png"></button>
                </div>
            </div>
            <div class="Row">
                <div class="Cell">
                    <p>Blood</p>
                </div>
                <div class="Cell">
                    <p>
                        Full Blood Count <br/>Malaria Screening<br/>ESR
                    </p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>9 ml</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>Row 1 Column 2</p>
                </div>
                <div class="Cell">
                    <button onmousedown="window.location='/test/1/collect_specimen'">
                        <img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/draw_sample.png">
                    </button>
                    <button><img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/delete.png"></button>
                </div>
            </div>
            <div class="Row">
                <div class="Cell">
                    <p>Blood</p>
                </div>
                <div class="Cell">
                    <p>
                        Liver Function Test <br/>Renal Function Test<br/>Pancreatic Function Test<br/>Electrolytes
                    </p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>9 ml</p>
                </div>
                <div class="Cell" style="text-align: center">
                    <p>Row 1 Column 2</p>
                </div>
                <div class="Cell">
                    <button onmousedown="window.location='/test/1/collect_specimen'">
                        <img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/draw_sample.png">
                    </button>
                    <button><img style="height:5vh;width: 3vw;vertical-align: middle;" src="/assets/images/delete.png"></button>
                </div>
            </div>
        </div>
    </div>
    <div id="orderModal" class="modalDialog">
        <div>
            <div style="height: 17%;text-align: center; border: 1px solid silver; padding:5px; border-radius: 5px 5px 0px 0px">
            <span  style="font-weight:bold;font-size: 20pt;">Laboratory Test Order</span><hr/>
            <table style="width:80%;">
                <tr>
                    <td >Patient</td><td>:</td>
                    <td>{{ pt_details.get('name') }}</td>
                </tr>
                <tr>
                    <td >Ordered By</td><td>:</td>
                    <td>{{current_user['current_user']}}</td>
                </tr>
                <tr>
                    <td>Order Date</td><td>:</td>
                    <td>{{now}}</td>
                </tr>
                <tr>
                    <td >Test</td><td>:</td>
                    <td>&nbsp;</td>
                </tr>
            </table>
        </div>
            <div style="height: 70%; overflow-y: auto;overflow-x: hidden;">
            <form id="regForm" method="post" action="/test/create">
                <!-- One "tab" for each step in the form: -->
                <div class="tab">
                    <h2>Specimen Type</h2>
                    <ul>
                        <div style="display: table-row;">
                            <div style='display: table-cell; vertical-align: center;'>
                                <li><input type='radio' id='Ascitic Fluid' required name='specimen_type'><label for='Ascitic Fluid'>Ascitic Fluid</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Blood' required name='specimen_type'><label for='Blood'>Blood</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='CSF' required name='specimen_type'><label for='CSF'>CSF</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='DBS' required name='specimen_type'><label for='DBS'>DBS</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='HVS' required name='specimen_type'><label for='HVS'>HVS</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Pericardial Fluid' required name='specimen_type'><label for='Pericardial Fluid'>Pericardial Fluid</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Peritoneal Fluid' required name='specimen_type'><label for='Peritoneal Fluid'>Peritoneal Fluid</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Pleural Fluid' required name='specimen_type'><label for='Pleural Fluid'>Pleural Fluid</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Pus' required name='specimen_type'><label for='Pus'>Pus</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Semen' required name='specimen_type'><label for='Semen'>Semen</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Sputum' required name='specimen_type'><label for='Sputum'>Sputum</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell; '>
                                <li><input type='radio' id='Stool' required name='specimen_type'><label for='Stool'>Stool</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Synovial Fluid' required name='specimen_type'><label for='Synovial Fluid'>Synovial Fluid</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Tissue biopsy' required name='specimen_type'><label for='Tissue biopsy'>Tissue biopsy</label><div class='check'></div></li>
                            </div>
                        </div>
                        <div style="display: table-row;">
                            <div style='display: table-cell;'>
                                <li><input type='radio' id='Urine' required name='specimen_type'><label for='Urine'>Urine</label><div class='check'></div></li>
                            </div>
                            <div style='display: table-cell;'>
                                &nbsp;
                            </div>
                        </div>
                    </ul>
                </div>
                <div class="tab">
                    <h2>Test Type</h2>
                    <ul>
                        <div style="display: table-row;">
                            <div style="display: table-cell;">
                                <li>
                                    <input type="checkbox" required id="pizza" name="test_type[]">
                                    <label for="pizza">Pizza</label>
                                    <div class="select"></div>
                                </li>
                            </div>
                            <div style="display: table-cell;">
                                <li>
                                    <input type="checkbox" id="cake" required name="test_type[]">
                                    <label for="cake">Cake</label>
                                    <div class="select"><div class="inside"></div></div>
                                </li>
                            </div>
                        </div>
                    </ul>
                </div>
                <div class="tab">
                    <h2>Clinical History</h2>
                    <input type="text" placeholder="Clinical history" name="clinical_history" id="default" class="input" value="{{
                      request.form.clinical_history }}" required style="width: 90%; font-size : 18pt;border-radius:5px;height: 7vh;">
                    <div class="simple-keyboard" style="width: 90%; border: 1px solid silver;margin-top: 2vh;"></div>
                </div>
                <div class="tab">
                    <ul>
                        <li>
                            <input type="radio" id="routine" name="priority" checked>
                            <label for="routine">Routine</label>
                            <div class="check"></div>
                        </li>
                        <li>
                            <input type="radio" id="stat" name="priority">
                            <label for="stat">Stat</label>
                            <div class="check"></div>
                        </li>
                    </ul>
                </div>
                <input type="hidden" name="patient_id" value={{pt_details.get('id')}} >
            </form>
        </div>
            <div style="height: 12%; margin-top: 1vh;border: 1px solid silver; padding:10px; border-radius: 0px 0px 5px 5px">
            <table style="width:100%;">
                <tr>
                    <td>
                        <a href="#close" title="Close" ><button type="button" class="modalNVButton red">Cancel</button></a>
                    </td>
                    <td style="text-align: center;">
                        <span class="step"></span>
                        <span class="step"></span>
                        <span class="step"></span>
                        <span class="step"></span>
                    </td>
                    <td style="text-align: right">
                        <button type="button" id="prevBtn" class="modalNVButton" onclick="nextPrev(-1)">Previous</button>
                        <button type="button" id="nextBtn" class="modalNVButton green" onclick="nextPrev(1)">Next</button>
                    </td>
                </tr>
            </table>
        </div>
        </div>
    </div>

    <script>
        var currentTab = 0; // Current tab is set to be the first tab (0)
        function showOrderDialog(){
            window.location='{{request.url}}#orderModal'
            showTab(0); // Display the current tab
        }

        function showDrawDialog(){
            document.getElementById("modalContent").innerHTML = document.getElementById("sampleDrawContent").innerHTML
            window.location='{{request.url}}#openModal'
        }
    </script>
    <script src="{{url_for('static', filename='javascript/keyboard.js')}}"></script>
    <script src="{{url_for('static', filename='javascript/keyboard_init.js')}}"></script>
{% endblock %}
